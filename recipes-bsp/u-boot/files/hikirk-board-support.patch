From 4779aafc0805dd8f62313d1ecbb0033fc79b7a07 Mon Sep 17 00:00:00 2001
From: Mario Schuknecht <schuknecht@dresearch-fe.de>
Date: Wed, 23 Jan 2013 12:27:31 +0100
Subject: [PATCH] hikirk: add spi support

Add spi support to hikirk board.

Signed-off-by: Mario Schuknecht <schuknecht@dresearch-fe.de>
---
 board/Marvell/openrd/openrd.c |    7 +++++++
 boards.cfg                    |    1 +
 include/configs/openrd.h      |   10 ++++++++++
 3 files changed, 18 insertions(+)

diff --git a/board/Marvell/openrd/openrd.c b/board/Marvell/openrd/openrd.c
index 2a10e69..e97dd0a 100644
--- a/board/Marvell/openrd/openrd.c
+++ b/board/Marvell/openrd/openrd.c
@@ -49,10 +49,17 @@ int board_early_init_f(void)
 
 	/* Multi-Purpose Pins Functionality configuration */
 	u32 kwmpp_config[] = {
+#ifdef CONFIG_BOARD_IS_HIKIRK
+		MPP0_SPI_SCn,
+		MPP1_SPI_MOSI,
+		MPP2_SPI_SCK,
+		MPP3_SPI_MISO,
+#else
 		MPP0_NF_IO2,
 		MPP1_NF_IO3,
 		MPP2_NF_IO4,
 		MPP3_NF_IO5,
+#endif
 		MPP4_NF_IO6,
 		MPP5_NF_IO7,
 		MPP6_SYSRST_OUTn,
diff --git a/boards.cfg b/boards.cfg
index 3cf75c3..1d5d47e 100644
--- a/boards.cfg
+++ b/boards.cfg
@@ -148,6 +148,7 @@ netspace_v2                  arm         arm926ejs   netspace_v2         LaCie
 dreamplug                    arm         arm926ejs   -                   Marvell        kirkwood
 guruplug                     arm         arm926ejs   -                   Marvell        kirkwood
 mv88f6281gtw_ge              arm         arm926ejs   -                   Marvell        kirkwood
+hikirk                       arm         arm926ejs   openrd              Marvell        kirkwood        openrd:BOARD_IS_HIKIRK
 openrd_base                  arm         arm926ejs   openrd              Marvell        kirkwood        openrd:BOARD_IS_OPENRD_BASE
 openrd_client                arm         arm926ejs   openrd              Marvell        kirkwood        openrd:BOARD_IS_OPENRD_CLIENT
 openrd_ultimate              arm         arm926ejs   openrd              Marvell        kirkwood        openrd:BOARD_IS_OPENRD_ULTIMATE
diff --git a/include/configs/openrd.h b/include/configs/openrd.h
index 53bafe1..62ea87e 100644
--- a/include/configs/openrd.h
+++ b/include/configs/openrd.h
@@ -33,6 +33,9 @@
 /*
  * Version number information
  */
+#ifdef CONFIG_BOARD_IS_HIKIRK
+# define CONFIG_IDENT_STRING	"\nhikirk"
+#else
 #ifdef CONFIG_BOARD_IS_OPENRD_ULTIMATE
 # define CONFIG_IDENT_STRING	"\nOpenRD-Ultimate"
 #else
@@ -46,6 +49,7 @@
 #  endif
 # endif
 #endif
+#endif
 
 /*
  * High Level Configuration Options (easy to change)
@@ -65,7 +69,13 @@
 #define CONFIG_CMD_DHCP
 #define CONFIG_CMD_ENV
 #define CONFIG_CMD_MII
+#ifdef CONFIG_BOARD_IS_HIKIRK
+#define CONFIG_SPI_FLASH_MACRONIX
+#define CONFIG_CMD_SPI
+#define CONFIG_CMD_SF
+#else
 #define CONFIG_CMD_NAND
+#endif
 #define CONFIG_CMD_PING
 #define CONFIG_CMD_USB
 #define CONFIG_CMD_IDE
-- 
1.7.9.5

